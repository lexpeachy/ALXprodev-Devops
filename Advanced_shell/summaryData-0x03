#!/bin/bash

# Output CSV file
CSV_FILE="pokemon_report.csv"

# Header for CSV file
echo "Name,Height (m),Weight (kg)" > "$CSV_FILE"

# Process each JSON file in the pokemon_data directory
for json_file in pokemon_data/*.json; do
    # Extract name, height, and weight from JSON
    name=$(jq -r '.name' "$json_file")
    height=$(jq -r '.height/10' "$json_file")  # Convert from decimeters to meters
    weight=$(jq -r '.weight/10' "$json_file")  # Convert from hectograms to kilograms
    
    # Append to CSV file
    echo "$name,$height,$weight" >> "$CSV_FILE"
done

# Sort the CSV file alphabetically by PokÃ©mon name (excluding header)
(head -n 1 "$CSV_FILE" && tail -n +2 "$CSV_FILE" | sort) > temp.csv && mv temp.csv "$CSV_FILE"

# Calculate averages using awk and sed
# First extract the data columns, then calculate averages
height_avg=$(tail -n +2 "$CSV_FILE" | cut -d',' -f2 | sed 's/^/+/' | tr '\n' ' ' | sed 's/ / +/g' | sed 's/+$//' | awk '{print "scale=2; (" $0 ")/" NR-1}' | bc)
weight_avg=$(tail -n +2 "$CSV_FILE" | cut -d',' -f3 | sed 's/^/+/' | tr '\n' ' ' | sed 's/ / +/g' | sed 's/+$//' | awk '{print "scale=2; (" $0 ")/" NR-1}' | bc)

# Print report
echo "CSV Report generated at: $CSV_FILE"
echo ""
cat "$CSV_FILE"
echo ""
echo "Average Height: $height_avg m"
echo "Average Weight: $weight_avg kg"
